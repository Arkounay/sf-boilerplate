{% extends '@!ArtgrisMedia/form/field_media.html.twig' %}

{% block render_media %}
    {% apply spaceless %}
        <div class="artgris-media mb-2 {% if form.vars.errors|length > 0 %}error{% endif %}">

            <div class="row border bg-white align-items-center p-2 mx-0">
                {% set base_path = form.vars.allow_crop ? get_web_path(conf, extra) : 1 %}
                {% block file_preview %}
                    <div class="img-preview text-center col-md-2 p-2" id="preview-{{ form.vars.id }}" data-id="{{ id }}" data-conf="{{ conf }}"
                         data-extra="{{ extra|json_encode }}" data-base-path="{{ base_path }}">
                        {% set preview = fileIcon(form.vars.data).html %}
                        {% if form.vars.allow_crop and '<img' in preview and '.svg' not in preview and form.vars.data[:base_path|length] == base_path %}
                            <a href="#" class="js-crop crop-hover" data-bs-toggle="modal" data-bs-target="#crop-modal-{{ id }}" data-backdrop="static">
                                <span class="artgris-media-crop-wrapper"><i class="fas fa-crop"></i></span>
                                {{ preview|raw }}
                            </a>
                        {% else %}
                            {{ preview|raw }}
                        {% endif %}
                    </div>
                {% endblock %}

                {#label + input#}
                <div class="{% if collection %}col-md-5{% else %}col-md-7{% endif %}">
                    {% block fields %}
                        <input type="text" class="form-control artgris-media-path" id="{{ form.vars.id }}" name="{{ form.vars.full_name }}"
                               {% if form.vars.required %}required="required"{% endif %} value="{{ form.vars.value }}"
                               placeholder="{{ 'artgris.media.path.placeholder'|trans }}" {{ form.vars.readonly|default ? 'readonly="readonly"' }}>
                    {% endblock %}
                </div>

                {% if collection %}
                    <div class="col-md-3 p-2 text-center">
                        <div class="btn-group" role="group">
                            {% block media_buttons_collection %}
                                {% include '@ArtgrisMedia/form/_btn_manager.html.twig' with {'id' : id, 'form' : form, 'conf': conf, 'extra': extra} only %}
                            {% endblock %}
                        </div>
                    </div>
                {% else %}
                    <div class="col-md-3 p-2 text-center">
                        <div class="btn-group artgris-browse-group" role="group">
                            {% block media_buttons %}
                                {% include '@ArtgrisMedia/form/_btn_manager.html.twig' with {'id' : id, 'form' : form, 'conf': conf, 'extra': extra, 'collection': false} only %}
                            {% endblock %}
                        </div>
                    </div>
                {% endif %}
                {% if collection %}
                    <div class="col-md-1">
                        <table class="table-sort m-auto">
                            <tr class="table-sort-up">
                                <td><a href="#" class="collection-up btn btn-light btn-x-sm"><span class="fas fa-chevron-up"></span></a></td>
                            </tr>
                            <tr class="table-sort-down">
                                <td><a href="#" class="collection-down btn btn-light btn-x-sm"><span class="fas fa-chevron-down"></span></a></td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-1 p-0 align-top order-md-last order-first">
                        <a href="#" class="float-end collection-remove btn btn-collection btn-collection-remove form_optionsGroups-collection-remove form_optionsGroups-collection-action"><svg width="16" height="16"><use xlink:href="/bundles/arkounayquickadmingenerator/tabler-sprite.svg#tabler-x"></use></svg></a>
                    </div>
                {% endif %}
            </div>

            {% if collection and form.vars.errors|length > 0 %}
                <div class="m-2 text-danger">
                    <b> {{ form_errors(form) }}</b>
                </div>
            {% endif %}

        </div>
    {% endapply %}
{% endblock %}
